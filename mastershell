# Install basic tools
sudo apt-get install nano screen build-essential parallel wget libmagickwand-dev libleptonica-dev libqt4-dev libxml2-dev libtool automake exactimage tesseract-ocr tesseract-ocr-deu* libqt4-dev libjpeg8-dev libjpeg-turbo8-dev libjpeg-dev git-core bash-completion nfs-common ghostscript ruby1.9.1 ruby1.9.1-dev rubygems1.9.1 irb1.9.1 ri1.9.1 rdoc1.9.1 build-essential python-pyexiv2 python-pyside iceweasel xterm python-netifaces python-pip python-yaml unzip cython libffi-dev libjpeg8-dev liblua5.1-0  libudev-dev libusb-1.0-0-dev libusb-dev nginx python2.7-dev libopenssl-ruby1.9.1 libssl-dev zlib1g-dev subversion cmake zlib1g-dev libpng12-dev libtiff5-dev libboost1.55-all-dev libxrender-dev
sudo wget --continue https://www.assembla.com/spaces/chdkptp/documents/aDDsvQyhOr465JacwqjQYw/download/aDDsvQyhOr465JacwqjQYw -O /tmp/chdkptp.zip || exit 1
sudo unzip -o -d /usr/local/lib/chdkptp /tmp/chdkptp.zip || exit 1
sudo rm -rf /tmp/chdkptp.zip || exit 1

# Get newest pip version
sudo pip install --upgrade pip || exit 1
sudo mv /usr/bin/pip /usr/bin/pip.old
ln -s /usr/local/bin/pip /usr/bin/pip
pip --version || exit 1

# Install CFFI
sudo pip install cffi || exit 1
# Install CFFI
sudo pip install redis || exit 1
sudo pip install huey || exit 1

echo "## Checking for Updates."
git pull || exit 1

# https://github.com/openxc/openxc-python/issues/18
sudo pip install --pre pyusb || exit 1
#pip install -e .[web] || exit 1
sudo python setup.py install || exit 1

# Install cython-hidapi from GitHub
sudo pip install git+https://github.com/gbishop/cython-hidapi.git || exit 1

# Install spreads
sudo pip install http://buildbot.diybookscanner.org/nightly/spreads-latest.tar.gz || exit 1

wget -O scantailor-enhanced-20140214.tar.bz2 http://downloads.sourceforge.net/project/scantailor/scantailor-devel/enhanced/scantailor-enhanced-20140214.tar.bz2?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fscantailor%2Ffiles%2Fscantailor-devel%2Fenhanced%2F&ts=1401223653&use_mirror=optimate
tar xvjf scantailor-enhanced-20140214.tar.bz2
git clone https://github.com/ifad/pdfbeads
git clone https://github.com/agl/jbig2enc

## make and install jbig2enc
cd jbig2enc
./autogen.sh
./configure
make
sudo make install
cd ..

## make and install pdfbeads
cd pdfbeads
gem build pdfbeads.gemspec 
sudo gem install pdfbeads-1.0.11.gem
cd ..

## make and install scantailor
cd scantailor-enhanced
cmake .
make
sudo make install
